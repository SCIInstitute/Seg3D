INCLUDE(InstallRequiredSystemLibraries)

SET(CPACK_PACKAGE_NAME "${APPLICATION_NAME}")

SET(CPACK_PACKAGE_DESCRIPTION_SUMMARY "${APPLICATION_NAME}")
SET(CPACK_PACKAGE_VENDOR "${APPLICATION_VENDOR}")
      
SET(CPACK_PACKAGE_DESCRIPTION_FILE ${PACKAGING_README} )
SET(CPACK_PACKAGE_DESCRIPTION_SUMMARY "${APPLICATION_NAME} ${SEG3D_MAJOR_VERSION}.${SEG3D_MINOR_VERSION}.${SEG3D_PATCH_VERSION} is a segmentation program")

SET(CPACK_RESOURCE_FILE_LICENSE ${PACKAGING_LICENSE})
SET(CPACK_RESOURCE_FILE_README ${PACKAGING_RELEASENOTES})
SET(CPACK_RESOURCE_FILE_WELCOME ${PACKAGING_WELCOME})

SET(CPACK_PACKAGE_VERSION_MAJOR "${SEG3D_MAJOR_VERSION}")
SET(CPACK_PACKAGE_VERSION_MINOR "${SEG3D_MINOR_VERSION}")
SET(CPACK_PACKAGE_VERSION_PATCH "${SEG3D_PATCH_VERSION}")

SET(CPACK_PACKAGE_INSTALL_DIRECTORY 
    "${APPLICATION_NAME} ${SEG3D_MAJOR_VERSION}.${SEG3D_MINOR_VERSION}")
    
IF(WIN32 AND NOT UNIX)
  # There is a bug in NSIS that does not handle full unix paths properly. Make
  # sure there is at least one set of four (4) backslashes.
  SET(CPACK_PACKAGE_ICON "${PACKAGING_ICON}")
    IF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
      SET(CPACK_INSTALL_PREFIX "/" CACHE PATH "Install path prefix, prepended onto install directories." FORCE)
      SET(CMAKE_INSTALL_PREFIX "/" CACHE PATH "Install path prefix, prepended onto install directories." FORCE)
    ENDIF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
  SET(CPACK_NSIS_INSTALLED_ICON_NAME "bin\\${APPLICATION_NAME}")
  SET(CPACK_NSIS_MUI_ICON "${APPLICATION_WINDOWS_ICON}")
  SET(CPACK_NSIS_DISPLAY_NAME "${APPLICATION_NAME} ${SEG3D_MAJOR_VERSION}.${SEG3D_MINOR_VERSION}")
  SET(CPACK_NSIS_HELP_LINK "http:\\\\${APPLICATION_URL}")
  SET(CPACK_NSIS_URL_INFO_ABOUT "http:\\\\${APPLICATION_URL}")
  SET(CPACK_NSIS_CONTACT ${APPLICATION_CONTACT} )
  SET(CPACK_NSIS_MODIFY_PATH ON)
  SET(CPACK_PACKAGE_EXECUTABLES "${APPLICATION_NAME}" "${APPLICATION_NAME}")
  SET(CPACK_NSIS_EXTRA_INSTALL_COMMANDS "
  WriteRegStr HKCR '.nrrd' '' '${APPLICATION_NAME}-nrrd'
  WriteRegStr HKCR '${APPLICATION_NAME}-nrrd' '' '${APPLICATION_NAME} NRRD File'
  WriteRegStr HKCR '${APPLICATION_NAME}-nrrd\\shell' '' 'open'
  WriteRegStr HKCR '${APPLICATION_NAME}-nrrd\\DefaultIcon' '' '$INSTDIR\\bin\\${APPLICATION_NAME}.exe,0'
  WriteRegStr HKCR '${APPLICATION_NAME}-nrrd\\shell\\open\\command' '' '$INSTDIR\\bin\\${APPLICATION_NAME}.exe \"%1\"'
  WriteRegStr HKCR '${APPLICATION_NAME}-nrrd\\shell\\edit' '' 'Open NRRD Data File'
  WriteRegStr HKCR '${APPLICATION_NAME}-nrrd\\shell\\edit\\command' '' '$INSTDIR\\bin\\${APPLICATION_NAME}.exe \"%1\"'
  #System::Call 'Shell32::SHChangeNotify( i 0x800000, i 0, i 0, i 0)'
  WriteRegStr HKCR '.nhdr' '' '${APPLICATION_NAME}-nhdr'
  WriteRegStr HKCR '${APPLICATION_NAME}-nhdr' '' '${APPLICATION_NAME} NHDR File'
  WriteRegStr HKCR '${APPLICATION_NAME}-nhdr\\shell' '' 'open'
  WriteRegStr HKCR '${APPLICATION_NAME}-nhdr\\DefaultIcon' '' '$INSTDIR\\bin\\${APPLICATION_NAME}.exe,0'
  WriteRegStr HKCR '${APPLICATION_NAME}-nhdr\\shell\\open\\command' '' '$INSTDIR\\bin\\${APPLICATION_NAME}.exe \"%1\"'
  WriteRegStr HKCR '${APPLICATION_NAME}-nhdr\\shell\\edit' '' 'Open NHDR Data File'
  WriteRegStr HKCR '${APPLICATION_NAME}-nhdr\\shell\\edit\\command' '' '$INSTDIR\\bin\\${APPLICATION_NAME}.exe \"%1\"'
  #System::Call 'Shell32::SHChangeNotify( i 0x800000, i 0, i 0, i 0)'
  WriteRegStr HKCR '${APPLICATION_EXTENSION}' '' '${APPLICATION_NAME}'
  WriteRegStr HKCR '${APPLICATION_NAME}' '' '${APPLICATION_NAME} Project File'
  WriteRegStr HKCR '${APPLICATION_NAME}\\shell' '' 'open'
  WriteRegStr HKCR '${APPLICATION_NAME}\\DefaultIcon' '' '$INSTDIR\\bin\\${APPLICATION_NAME}.exe,0'
  WriteRegStr HKCR '${APPLICATION_NAME}\\shell\\open\\command' '' '$INSTDIR\\bin\\${APPLICATION_NAME}.exe \"%1\"'
  WriteRegStr HKCR '${APPLICATION_NAME}\\shell\\edit' '' 'Open ${APPLICATION_NAME} Project File'
  WriteRegStr HKCR '${APPLICATION_NAME}\\shell\\edit\\command' '' '$INSTDIR\\bin\\${APPLICATION_NAME}.exe \"%1\"'
  System::Call 'Shell32::SHChangeNotify( i 0x800000, i 0, i 0, i 0)'
  ")
  SET(CPACK_NSIS_EXTRA_UNINSTALL_COMMANDS "
  DeleteRegKey HKCR '.nrrd'
  DeleteRegKey HKCR '.nhdr'
  DeleteRegKey HKCR '${APPLICATION_EXTENSION}'
  DeleteRegKey HKCR '${APPLICATION_NAME}'
  ")
ELSE(WIN32 AND NOT UNIX)
  IF(APPLE)
    SET(CPACK_PACKAGE_DEFAULT_LOCATION "/Applications/")
    SET(CPACK_TOPLEVEL_TAG "")
    IF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
      SET(CPACK_INSTALL_PREFIX "/" CACHE PATH "Install path prefix, prepended onto install directories." FORCE)
      SET(CMAKE_INSTALL_PREFIX "/" CACHE PATH "Install path prefix, prepended onto install directories." FORCE)
    ENDIF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
    SET(CPACK_PACKAGING_INSTALL_PREFIX "/")
    SET(CPACK_STRIP_FILES TRUE)
    SET(CPACK_SOURCE_STRIP_FILES TRUE)
    SET(CPACK_PACKAGE_EXECUTABLES "${APPLICATION_NAME}.app" "${APPLICATION_NAME}")
  ELSE(APPLE)
    SET(CPACK_STRIP_FILES TRUE)
    SET(CPACK_SOURCE_STRIP_FILES TRUE)
    SET(CPACK_PACKAGE_EXECUTABLES "${APPLICATION_NAME}" "${APPLICATION_NAME}")
  ENDIF(APPLE)
ENDIF(WIN32 AND NOT UNIX)

INCLUDE(CPack)

